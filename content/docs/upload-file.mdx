---
title: UploadFile Component & Hook
description: A React component and hook for secure file uploads with progress tracking
---

## Usage

### Component

```tsx
import { UploadFile } from '@/components/upload-file';

export function MyPage() {
  return (
    <div>
      <h2>Upload your files</h2>
      <UploadFile />
    </div>
  );
}
```

### Hook

```tsx
import { useUploadFile } from '@/hooks/use-upload-file';

export function CustomUploadComponent() {
  const uploadFile = useUploadFile();

  const handleUpload = (file: File) => {
    uploadFile.mutate(
      { file },
      {
        onSuccess: (url) => console.log('Uploaded to:', url),
        onError: (err) => console.error('Upload failed:', err),
      }
    );
  };

  return (
    <input
      type="file"
      onChange={(e) => {
        const file = e.target.files?.[0];
        if (file) handleUpload(file);
      }}
    />
  );
}
```

## Installation

<InstallTabs component="upload-file" />

## Component Features

- **File Selection**: Styled file input with hover effects
- **Progress Tracking**: Visual progress bar during upload
- **Error Handling**: Built-in error logging and user feedback
- **Responsive Design**: Works well on all screen sizes

## Hook API

### Parameters

The `useUploadFile` hook returns a mutation object that accepts:

| Parameter    | Type                              | Description                           |
|--------------|-----------------------------------|---------------------------------------|
| `file`       | `File`                           | The file to upload                    |
| `onProgress` | `(percent: number) => void`      | Optional progress callback            |

### Return Value

Returns a TanStack Query mutation with:

- `mutate()` - Function to trigger the upload
- `isPending` - Boolean indicating if upload is in progress
- `isError` - Boolean indicating if upload failed
- `error` - Error object if upload failed
- `data` - The file URL after successful upload

## Examples

### Basic Upload Component

```tsx
import { UploadFile } from '@/components/upload-file';

export function DocumentUpload() {
  return (
    <div className="p-6 border rounded-lg">
      <h3 className="text-lg font-semibold mb-4">Upload Document</h3>
      <UploadFile />
    </div>
  );
}
```

### Custom Upload with Progress

```tsx
import { useState } from 'react';
import { useUploadFile } from '@/hooks/use-upload-file';

export function CustomUpload() {
  const [progress, setProgress] = useState(0);
  const [uploadedUrl, setUploadedUrl] = useState<string | null>(null);
  const uploadFile = useUploadFile();

  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    uploadFile.mutate(
      { file, onProgress: setProgress },
      {
        onSuccess: (url) => {
          setUploadedUrl(url);
          setProgress(0);
        },
        onError: (err) => {
          console.error('Upload failed:', err);
          setProgress(0);
        },
      }
    );
  };

  return (
    <div className="space-y-4">
      <input type="file" onChange={handleFileChange} />

      {uploadFile.isPending && (
        <div className="w-full bg-gray-200 rounded-full h-2">
          <div
            className="bg-blue-600 h-2 rounded-full transition-all"
            style={{ width: `${progress}%` }}
          />
        </div>
      )}

      {uploadedUrl && (
        <div className="p-4 bg-green-50 rounded">
          <p>Upload successful!</p>
          <a href={uploadedUrl} target="_blank" rel="noopener noreferrer">
            View file
          </a>
        </div>
      )}
    </div>
  );
}
```

### Multiple File Upload

```tsx
import { useState } from 'react';
import { useUploadFile } from '@/hooks/use-upload-file';

export function MultipleUpload() {
  const [uploads, setUploads] = useState<Record<string, number>>({});
  const uploadFile = useUploadFile();

  const handleFilesChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = Array.from(e.target.files || []);

    files.forEach((file) => {
      const fileId = `${file.name}-${Date.now()}`;

      uploadFile.mutate(
        {
          file,
          onProgress: (progress) => {
            setUploads(prev => ({ ...prev, [fileId]: progress }));
          }
        },
        {
          onSuccess: (url) => {
            console.log(`${file.name} uploaded to:`, url);
            setUploads(prev => {
              const { [fileId]: _, ...rest } = prev;
              return rest;
            });
          },
          onError: (err) => {
            console.error(`${file.name} upload failed:`, err);
            setUploads(prev => {
              const { [fileId]: _, ...rest } = prev;
              return rest;
            });
          },
        }
      );
    });
  };

  return (
    <div>
      <input type="file" multiple onChange={handleFilesChange} />

      {Object.entries(uploads).map(([fileId, progress]) => (
        <div key={fileId} className="mt-2">
          <div className="flex justify-between text-sm">
            <span>{fileId.split('-')[0]}</span>
            <span>{progress}%</span>
          </div>
          <div className="w-full bg-gray-200 rounded-full h-1">
            <div
              className="bg-blue-600 h-1 rounded-full transition-all"
              style={{ width: `${progress}%` }}
            />
          </div>
        </div>
      ))}
    </div>
  );
}
```

## API Integration

The hook expects an API endpoint at `/api/uploads/presign` that:

1. Accepts POST requests with `fileName` and `contentLength`
2. Returns a JSON response with `uploadUrl` and `fileUrl`
3. Uses the `generatePresignedUploadUrl` function

Example API route:

```typescript
// app/api/uploads/presign/route.ts
import { generatePresignedUploadUrl } from '@/lib/generate-presigned-upload-url';

export async function POST(request: Request) {
  const { fileName, contentLength } = await request.json();

  try {
    const result = await generatePresignedUploadUrl({
      fileName,
      contentLength,
    });

    return Response.json(result);
  } catch (error) {
    return Response.json(
      { error: 'Failed to generate upload URL' },
      { status: 500 }
    );
  }
}
```

## Dependencies

- `@tanstack/react-query` - For mutation management
- `react` - For component functionality

## Styling

The component uses Tailwind CSS classes and assumes the following CSS variables are available:

- `--secondary` - Background color for file input
- `--secondary-foreground` - Text color for file input
- `--primary` - Progress bar color
- `--muted-foreground` - Muted text color

## Implementation

### UploadFile Component

```tsx
'use client';

import { type ChangeEvent, useState } from 'react';
import { useUploadFile } from '@/hooks/use-upload-file';

export function UploadFile() {
  const [progress, setProgress] = useState(0);
  const uploadFile = useUploadFile();

  const handleFileChange = (e: ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    uploadFile.mutate(
      { file, onProgress: (p) => setProgress(p) },
      {
        onSuccess: (url) => console.log('Uploaded to:', url),
        onError: (err) => console.error('Upload failed:', err),
        onSettled: () => setProgress(0),
      }
    );
  };

  return (
    <div className="flex flex-col gap-4">
      <input
        type="file"
        onChange={handleFileChange}
        className="file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-secondary file:text-secondary-foreground hover:file:bg-secondary/80"
      />

      {uploadFile.isPending && (
        <div className="mt-4 flex items-center gap-2">
          <div className="w-full h-2 bg-secondary rounded-full">
            <div
              className="h-2 bg-primary rounded-full transition-all duration-300"
              style={{ width: `${progress}%` }}
            />
          </div>
          <span className="text-sm text-muted-foreground">{progress}%</span>
        </div>
      )}
    </div>
  );
}
```

### useUploadFile Hook

```tsx
import { useMutation } from '@tanstack/react-query';

type UploadArgs = {
  file: File;
  onProgress?: (percent: number) => void;
};

export function useUploadFile() {
  return useMutation({
    mutationFn: async ({ file, onProgress }: UploadArgs) => {
      // Get presigned URL
      const presignRes = await fetch('/api/uploads/presign', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          fileName: file.name,
          contentLength: file.size,
        }),
      });

      if (!presignRes.ok) throw new Error('Failed to get presigned URL');
      const presign = await presignRes.json();

      // Upload file with progress tracking
      await new Promise<void>((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open('PUT', presign.uploadUrl);
        xhr.setRequestHeader('Content-Type', file.type);

        xhr.upload.onprogress = (evt) => {
          if (evt.lengthComputable && onProgress) {
            const percent = Math.round((evt.loaded * 100) / evt.total);
            onProgress(percent);
          }
        };

        xhr.onload = () => {
          if (xhr.status >= 200 && xhr.status < 300) resolve();
          else reject(new Error('Upload failed'));
        };

        xhr.onerror = () => reject(new Error('Upload failed'));
        xhr.send(file);
      });

      return presign.fileUrl as string;
    },
  });
}
```
